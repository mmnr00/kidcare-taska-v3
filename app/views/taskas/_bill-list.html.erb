<!-- START TABLE -->
<!-- DataTales Example -->
<div class="card shadow mb-4">
  <div class="card-header">
    <div class="row"><% if params[:no_sch].blank? %>
      <%= form_tag mybill_path, method: :get, id: "find_kid" do %>
        <%
          yr_s = (Date.today.year) - 3
          yr_e = (Date.today.year) + 1
        %>
        <%= select_tag :sch_yr, options_for_select(yr_s..yr_e, params[:sch_yr]), include_blank: "All Year" %>
        <%= select_tag :sch_mth, options_for_select(1..12, params[:sch_mth]), include_blank: "All Months" %>
        <%= select_tag :sch_stt, options_for_select([["PAID",true],["DUE",false]], 
          params[:sch_stt]), include_blank: "All Status" %>
        <%= text_field_tag :sch_str, params[:sch_str], placeholder: "Search Name", style: 'text-transform: uppercase' %>
        <%= hidden_field_tag :sch, params[:sch], value: true %>
        <%= hidden_field_tag :id, params[:id], value: @taska.id %>
        <%= button_tag(type: :submit, class: "badge badge-success shadow-none", style: "font-size: 14px; border-style: none; font-weight: normal",  id: "submit_expense") do %>
            <i class="fa fa-search"></i> Search
        <% end %>
        <%= link_to mybill_path(id: @taska.id, sch: true, sch_yr: Date.today.year, sch_mth: Date.today.month), class: "badge badge-danger shadow-sm", style: "font-size: 14px; font-weight: normal" do %>
            <i class="fa fa-sync"></i> Clear
        <% end %>
        <%= "#{@payments.count} result(s) found" unless params[:sch].blank? %>
      <% end %>
      <div>
        
      </div>
    <% end %></div>
  </div>
  <% if @payments.count < 1 %>
    <br>
    <div style="background-color:#ffcccc"><h3 align="center">NO RESULT FOUND</h3></div>
  <% else %>
    <div class="card-body">
    <div class="table table-responsive border" style="font-size:13px">
      
      <table class="table table-bordered table-striped shadow" id="dataTable" width="100%" cellspacing="0">
        <thead>
          <tr class="shadow" style="text-color:black">
            <th style="background-color:#ffccff; width: 5%">MONTH</th>
            <th style="background-color:#ffccff; width: 40%">BILL TO</th>
            <th style="background-color:#ffccff; width: 20%">ACTIONS</th>
            <th style="background-color:#ffccff; width: 5%">STATUS</th>
            <th style="background-color:#ffccff; width: 5%">TOTAL</th>
            <th style="background-color:#ffccff; width: 5%">PAID</th>
            <th style="background-color:#ffccff; width: 5%">DUE</th>
            <th style="background-color:#ffccff; width: 20%">DETAILS</th>
            
          </tr>
        </thead>
        <tbody>
          <% @payments.order('bill_year DESC').order('bill_month DESC').each do |pmt| %>
            <% kbls = pmt.kid_bills %>
            <tr>
              <td><%= "#{pmt.bill_month}-#{pmt.bill_year}" %></td>
              <td><ol>
                <% kbls.each do |kb| %>
                  <li style="margin-left: -25px"><%= kb.kidname %></li>
                <% end %>
              </ol></td>
              <td>
                <%= link_to "View", new_kid_path(taska_id: @taska.id), class: "badge badge-primary", style: "font-size: 13px" %>
                <% if !pmt.paid %>
                  <%= link_to "Edit", new_kid_path(taska_id: @taska.id), class: "badge badge-warning", style: "font-size: 13px" %>
                  <% if pmt.parpayms.blank? %>
                    <%= link_to "Delete", new_kid_path(taska_id: @taska.id), class: "badge badge-danger", style: "font-size: 13px" %>
                  <% end %>
                <% end %>
              </td>
              <%
                tot_pmt = pmt.amount
                paid_pmt = 0.00
                
                if pmt.paid
                  stat = "PAID"
                  clr = "#cce5cc"
                  paid_pmt = pmt.amount
                else
                  if pmt.parpayms.present?
                    stat = "BALANCE"
                    clr = "#ffdb99"
                    paid_pmt = pmt.parpayms.sum(:amt)
                  else
                    stat = "NOT PAID"
                    clr = "#ff9999"
                  end
                end
                bal_pmt = tot_pmt - paid_pmt
              %>
              <td style="background-color: <%= clr %>">
                <b><%= stat %></b><br>
                <% if !pmt.paid %>
                <%= link_to "Update", new_kid_path(taska_id: @taska.id), class: "badge badge-secondary", style: "font-size: 10px" %>
                <% end %>

              </td>
              <td>
                <%= number_with_delimiter(tot_pmt.round(2), :delimiter => ',')  %>
              </td>
              <td>
                <%= number_with_delimiter(paid_pmt.round(2), :delimiter => ',')  %>
              </td>
              <td>
                <%= number_with_delimiter(bal_pmt.round(2), :delimiter => ',')  %>
              </td>
              <td>
                <% if pmt.paid %>
                  Made using <b><%= pmt.mtd %></b><br>
                  On <b><%= pmt.updated_at.strftime('%d-%b-%y') %></b>
                <% elsif pmt.parpayms.present? %>
                 Please refer to 
                 <a href="<%= billview_url(pmt: pmt.id)%>" target="_blank">HERE</a>
                 for details
                <% end %>
              </td>
            </tr>
            
          
          <% end %> <!-- END LOOP -->
        </tbody>
      </table>
    </div>
  </div>
  <% end %>
</div>